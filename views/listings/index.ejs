<% layout('layouts/boilerplate') %>
<style>
  /* Filters (kept minimal) */
  .filters {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
  }
  .filter { margin-right: 1.5rem; margin-top: 1.5rem; }

  /* Improved listing cards */
  .listing-card {
    border-radius: 14px;
    overflow: hidden;
    transition: transform .22s ease, box-shadow .22s ease;
    background: white;
  }
  .listing-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 18px 36px rgba(16,24,40,0.12);
  }
  /* Image media area: show full image (no cropping) */
  .listing-card .media {
    position: relative;
    width: 100%;
    border-top-left-radius: 14px;
    border-top-right-radius: 14px;
    background: #fff; /* fallback background for letterboxing */
    display:flex; align-items:center; justify-content:center;
  }
  .listing-card .media img {
    position: relative;
    width: 100%;
    height: auto; /* preserve full image */
    object-fit: contain;
    object-position: center;
    transition: transform .25s ease;
    display:block;
  }
  /* remove aggressive zoom on hover so image stays fully visible */
  .listing-card:hover .media img { transform: none; }

  .listing-card .card-body { padding: 1rem; }
  .listing-card .card-title { font-size: 1.05rem; font-weight: 700; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .listing-card .card-text { font-size: 0.88rem; color: #6c757d; margin: 6px 0 8px; }

  .fee { color: #0d6efd; font-weight: 800; font-size: 1.15rem; }
  .meta-row { display:flex; align-items:center; justify-content:space-between; gap:8px; }

  .fav-badge {
    position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.95); border-radius: 50%; width:36px; height:36px; display:flex; align-items:center; justify-content:center; box-shadow: 0 6px 18px rgba(13,110,253,0.06);
  }

  .rating-pill { background: linear-gradient(90deg,#ffd54a,#ffc107); color:#111; padding:4px 8px; border-radius:12px; font-weight:700; display:inline-flex; align-items:center; gap:6px; }

  .card-footer-cta { display:flex; align-items:center; gap:8px; }
  .card-footer-cta .btn { font-size:0.9rem; padding:6px 10px; }

  /* tax info toggle */
  .tax-info{ display: none; }

  .tax-switch { border: 2px solid #0d6efd; border-radius: 2rem; background: linear-gradient(90deg, #e7f1ff 0%, #f8fafc 100%); padding: .6rem 1.2rem; margin-left: 1.2rem; display:flex; align-items:center; }
  .tax-switch label { font-weight:600; color:#0d6efd; margin-left: .6rem; }
  /* Hero banner */
  .hero-banner {
    border-radius: 14px;
    background: linear-gradient(180deg, #ffffff 0%, #f7fffb 100%);
    padding: 1.2rem 1.4rem;
    margin-bottom: 1.6rem;
    box-shadow: 0 6px 20px rgba(16,24,40,0.04);
  }
  .hero-inner { display:flex; gap:1.6rem; align-items:center; }
  .hero-img { width:48%; max-width:560px; border-radius:12px; box-shadow: 0 8px 30px rgba(13,110,253,0.06); }
  .hero-text { width:52%; }
  .hero-text h1 { font-size:1.8rem; margin-bottom:0.6rem; }
  .hero-text p { color:#556b6b; font-size:1rem; margin-bottom:1rem; }
  .hero-cta .btn { padding:10px 18px; border-radius:8px; }
  @media (max-width: 768px) {
    .hero-inner { flex-direction:column; }
    .hero-img, .hero-text { width:100%; }
  }
</style>

<style>
  /* local banner tweaks */
  .hero-top-space { padding-top: 4.5rem; } /* space from navbar */
  .hero-text h1{
    background: linear-gradient(90deg,#0d6efd 0%,#00c6ff 100%);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    font-size: 2.1rem;
    font-weight: 800;
    margin-bottom: 0.35rem;
    letter-spacing: -0.4px;
    text-shadow: 0 10px 30px rgba(13,110,253,0.06);
  }
  .hero-sub { color:#0b5e68; font-weight:700; margin-bottom:0.6rem; }
  .hero-text p { color:#476b66; font-size:1.02rem; line-height:1.5; margin-bottom:1rem; }
  .hero-cta .btn { border-radius:10px; padding:10px 18px; box-shadow:0 8px 24px rgba(13,110,253,0.06); }
  .hero-img { max-height:360px; object-fit:cover; border-radius:10px; }
  @media (max-width:768px) { .hero-top-space { padding-top:3.5rem; } .hero-text h1{font-size:1.6rem;} }
</style>

<div class="hero-top-space">
  <div class="container">
    <div class="hero-banner">
      <div class="hero-inner">
        <img class="hero-img" src="https://images.unsplash.com/photo-1522202176988-66273c2fd55f?auto=format&fit=crop&w=1400&q=80" alt="Learn online">
        <div class="hero-text">
          <h1>Learn. Compare. Enroll â€” Faster.</h1>
          <div class="hero-sub">Top courses, real reviews, curated deals</div>
          <p>
            Coursely connects you with the best programs in
            <strong>Fullâ€‘Stack Development, AI/ML, Data Structures & Algorithms</strong>, and more.
            Compare verified reviews, discover exclusive discounts, and enroll confidently in one click.
            <br><br>
            ðŸ”¥ <strong>Want the best deal?</strong> Message us to unlock limited-time offers.
          </p>
          <div class="hero-cta">
            <a href="/listings" class="btn btn-primary me-2">Explore Courses</a>
            <a href="https://wa.me/919907876770?text=Hi%20Coursely,%20I%20want%20to%20add%20a%20course." class="btn btn-outline-secondary" target="_blank">Add a Course</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4 mb-4 mt-3">
  <% for(let listing of alllisting) { %>
    <div class="col">
      <div class="card h-100 border-0 shadow-sm listing-card">
        <a href="/listings/<%= listing._id %>" class="text-decoration-none text-dark">
          <div class="media">
            <img src="<%= listing.thumbnail %>" alt="listing image">
            <div class="fav-badge">
              <i class="bi bi-heart"></i>
            </div>
            <div style="position:absolute; left:10px; bottom:10px;">
                <span class="rating-pill"><i class="bi bi-star-fill"></i> <%= listing.avgRating || listing.rating || "3.5" %></span>
            </div>
          </div>
          <div class="card-body">
            <div class="meta-row">
              <h5 class="card-title"><%= listing.title %></h5>
            </div>
            <p class="card-text"><%= listing.category || "General" %></p>
            <div class="d-flex align-items-center justify-content-between">
              <div>
                <div class="fee">&#8377;<%= (listing.fee || 0).toLocaleString("en-IN") %></div>
                <div class="text-muted" style="font-size:0.85rem">Starts soon</div>
              </div>
              <div class="card-footer-cta">
                <button class="btn btn-outline-primary" onclick="event.preventDefault(); event.stopPropagation(); location.href='/listings/<%= listing._id %>'">Preview</button>
                <button class="btn btn-primary" 
                  <% if (!listing.url) { %> disabled title="No course URL provided" <% } else { %>
                    onclick="event.preventDefault(); event.stopPropagation(); window.open('<%= listing.url %>', '_blank', 'noopener')"
                  <% } %>
                >Enroll</button>
              </div>
            </div>
          </div>
        </a>
      </div>
    </div>
  <% } %>
</div>

<script>
  let priceSwitch = document.getElementById('flexSwitchCheckDefault');
  priceSwitch.addEventListener('click', ()=> {
    let taxinfo=document.getElementsByClassName('tax-info');
    for(info of taxinfo){
      if(priceSwitch.checked){
        info.style.display='inline';
      }else{
        info.style.display='none';
      }
    }
   }
  )
  </script>
